version: '3.8'

services:
  # 1. Frontend: Serves the Modern UI and acts as the Reverse Proxy
  frontend-ui:
    build:
      context: ./frontend
      dockerfile: frontend.Dockerfile  # Fixed typo here
    container_name: cnnct-frontend
    ports:
      - "80:80"
    depends_on:
      - backend-api
    networks:
      cnnct-network:
        aliases:
          - frontend

  # 2. Backend: Flask API handling the network probes
  backend-api:
    build:
      context: .
      dockerfile: backend.Dockerfile
    container_name: cnnct-backend
    environment:
      - HOST=0.0.0.0
      - PORT=8080
      - REDIS_URL=redis://redis-cache:6379/0
      - PYTHONUNBUFFERED=1
    ports:
      - "8080:8080"
    depends_on:
      - redis-cache
    networks:
      cnnct-network:
        aliases:
          - backend-api

  # 3. Redis: Local equivalent of DigitalOcean's Valkey
  redis-cache:
    image: redis:7-alpine
    container_name: cnnct-redis
    networks:
      cnnct-network:
        aliases:
          - redis-cache

networks:
  cnnct-network:
    driver: bridge